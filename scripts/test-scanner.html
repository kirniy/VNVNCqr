<!DOCTYPE html>
<html>
<head>
    <title>QR Scanner Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #000; color: #0f0; }
        .test { margin: 20px 0; padding: 10px; border: 1px solid #0f0; }
        .pass { color: #0f0; }
        .fail { color: #f00; }
        .code { background: #111; padding: 5px; }
    </style>
</head>
<body>
    <h1>QR Code Format Test</h1>
    <div id="results"></div>

    <script>
        // Test QR codes from different sources
        const testCases = [
            // URL formats
            'https://angarqr.web.app/v/ANGAR-2025-0020',
            'https://angarqr.web.app/v/ANGAR-BNFBP5-3UK5KR69KG54TNY',
            'https://angarqr.web.app/v/ANGAR-BX7K9M-2P8N4Q6R5T7Y9',
            
            // Direct codes
            'ANGAR-2025-0020',
            'ANGAR-BNFBP5-3UK5KR69KG54TNY',
            'ANGAR-BX7K9M-2P8N4Q6R5T7Y9',
            
            // Invalid formats
            'ANGAR-2025',
            'ANGAR-TEST-1234',
            'https://example.com/ANGAR-2025-0020'
        ];

        // Same regex patterns used in scanner
        const oldFormatRegex = /^ANGAR-\d{4}-\d{4}$/;
        const newFormatRegex = /^ANGAR-B[A-Z0-9]{5}-[A-Z0-9]+$/;

        function processCode(scannedData) {
            let code = scannedData;
            
            // Extract code from URL if needed (same logic as scanner)
            if (scannedData.includes('/v/')) {
                const match = scannedData.match(/\/v\/([A-Z0-9-]+)/);
                code = match ? match[1] : scannedData;
            }
            
            const oldMatch = oldFormatRegex.test(code);
            const newMatch = newFormatRegex.test(code);
            const isValid = oldMatch || newMatch;
            
            return {
                original: scannedData,
                extracted: code,
                oldFormat: oldMatch,
                newFormat: newMatch,
                valid: isValid
            };
        }

        // Run tests
        const results = document.getElementById('results');
        
        testCases.forEach((testCase, index) => {
            const result = processCode(testCase);
            
            const div = document.createElement('div');
            div.className = 'test';
            div.innerHTML = `
                <h3>Test ${index + 1}</h3>
                <p>Input: <span class="code">${result.original}</span></p>
                <p>Extracted: <span class="code">${result.extracted}</span></p>
                <p>Old Format: <span class="${result.oldFormat ? 'pass' : 'fail'}">${result.oldFormat}</span></p>
                <p>New Format: <span class="${result.newFormat ? 'pass' : 'fail'}">${result.newFormat}</span></p>
                <p>Valid: <span class="${result.valid ? 'pass' : 'fail'}">${result.valid ? '✅ PASS' : '❌ FAIL - Would show "НЕВЕРНЫЙ ФОРМАТ"'}</span></p>
            `;
            results.appendChild(div);
        });
    </script>
</body>
</html>